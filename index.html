<!DOCTYPE html>
<html>

  <head>
    <title>Shepherding</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
      }

      body {
        font-size: 13pt;
      }

      section {
        padding: 10px;
      }

      section h1 {
        float: left;
        font-size: 1.2em;
        line-height: 36px;
      }

      section h2 {
        float: right;
        font-size: 0.8em;
        line-height: 40px;
        color: rgb(100, 100, 100);
      }

      .clear {
        clear: both;
      }

      section:nth-child(1) {
        background: rgb(220, 220, 220);
      }

      section:nth-child(2) {
        background: rgb(230, 230, 230);
      }

      section:nth-child(3) {
        background: rgb(240, 240, 240);
      }

      section table {
        width: 100%;
        margin: 20px 0;
      }

      section table td {
        padding: 10px;
        font-weight: bold;
      }
    </style>

    <script src="//closure-library.googlecode.com/git/closure/goog/base.js"></script>
  </head>

  <body>
    <section id="current">
      <h1>Current</h1>
      <h2>Starts at: <span class="start_time"></span></h2>
      <div class="clear"></div>

      <table>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </table>
    </section>

    <section id="next">
      <h1>Next</h1>
      <h2>Starts at: <span class="start_time"></span></h2>
      <div class="clear"></div>

      <table>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </table>
    </section>

    <section id="next-plus-one">
      <h1>Next+1</h1>
      <h2>Starts at: <span class="start_time"></span></h2>
      <div class="clear"></div>

      <table>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </table>
    </section>

    <script>
      goog.require("goog.async.Delay");
      goog.require("goog.net.XhrIo");
      goog.require("goog.string.format");
    </script>

    <script>
      var getMatches = function(arena, callback) {
        var url = goog.string.format("/matches/%s?numbers=%s", arena, encodeURIComponent("current,next,next+1"));
        goog.net.XhrIo.send(url, function(e) {
          var res = e.target.getResponseJson();
          callback(res);
        });
      };

      var updateSection = function(matchA, matchB, section) {
        var startTime = section.querySelector(".start_time");
        startTime.textContent = matchA.start_time;

        var tds = section.querySelectorAll("table td");
        tds[0].textContent = matchA.teams[0];
        tds[1].textContent = matchA.teams[1];
        tds[2].textContent = matchB.teams[0];
        tds[3].textContent = matchB.teams[1];
        tds[4].textContent = matchA.teams[2];
        tds[5].textContent = matchA.teams[3];
        tds[6].textContent = matchB.teams[2];
        tds[7].textContent = matchB.teams[3];
      };

      var updateDelay = new goog.async.Delay(function() {
        getMatches("A", function(a) {
          getMatches("B", function(b) {
            updateDelay.start();
            updateSection(a.matches[0], b.matches[0], document.querySelector("#current"));
            updateSection(a.matches[1], b.matches[1], document.querySelector("#next"));
            updateSection(a.matches[2], b.matches[2], document.querySelector("#next-plus-one"));
          });
        });
      }, 20 * 1000);

      updateDelay.fire();
    </script>
  </body>

</html>
